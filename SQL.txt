DROP DATABASE IF EXISTS siv;
CREATE DATABASE siv;

USE siv;

-- USUÁRIOS DO SISTEMA
CREATE TABLE usuarios (
  id INT AUTO_INCREMENT PRIMARY KEY,
  login VARCHAR(100) NOT NULL UNIQUE,
  senha VARCHAR(255) NOT NULL
);

INSERT INTO usuarios (login, senha) VALUES
('Danilo', 'admin'),
('Raynan maciel', 'admin'),
('Lucas', 'admin');

-- FORNECEDORES  
CREATE TABLE fornecedor (
  id INT AUTO_INCREMENT PRIMARY KEY,
  nome VARCHAR(150) NOT NULL,
  cnpj VARCHAR(30)
);

-- CLIENTES
CREATE TABLE clientes (
  id INT AUTO_INCREMENT PRIMARY KEY,
  nome     VARCHAR(150) NOT NULL,
  cpf      VARCHAR(30),
  email    VARCHAR(150),
  telefone VARCHAR(40),
  endereco VARCHAR(255),
  renda DECIMAL(10,2),
  celular VARCHAR(40),
  nasc DATE
);

-- FUNCIONÁRIOS
CREATE TABLE funcionarios (
  id INT AUTO_INCREMENT PRIMARY KEY,
  nome     VARCHAR(150) NOT NULL,
  cpf      VARCHAR(30),
  email    VARCHAR(150),
  telefone VARCHAR(40),
  cargo    VARCHAR(100),
  imagem   VARCHAR(255)
);

-- PRODUTOS  
CREATE TABLE produtos (
  id INT AUTO_INCREMENT PRIMARY KEY,
  nome      VARCHAR(200) NOT NULL,
  descricao TEXT,
  preco     DECIMAL(10,2) DEFAULT 0.00,
  estoque   INT DEFAULT 0,
  fornecedor_id INT,

  CONSTRAINT fk_produto_fornecedor
    FOREIGN KEY (fornecedor_id) REFERENCES fornecedor(id)
    ON DELETE SET NULL
);

-- ESTOQUE
CREATE TABLE estoque (
  id INT AUTO_INCREMENT PRIMARY KEY,
  produto_id INT NOT NULL,
  tipo       VARCHAR(20) NOT NULL,
  quantidade INT NOT NULL,
  data_mov   DATE NOT NULL,
  preco      DECIMAL(10,2),

  CONSTRAINT fk_estoque_produto 
    FOREIGN KEY (produto_id) REFERENCES produtos(id)
    ON DELETE CASCADE
);

-- VENDAS
CREATE TABLE venda (
  id INT AUTO_INCREMENT PRIMARY KEY,
  cliente_id INT,
  produto_id INT,
  quantidade INT NOT NULL,
  funcionario_venda_id INT,
  data_venda DATE NOT NULL,
  total      DECIMAL(10,2),

  CONSTRAINT fk_venda_cliente 
    FOREIGN KEY (cliente_id) REFERENCES clientes(id) ON DELETE SET NULL,

  CONSTRAINT fk_venda_produto 
    FOREIGN KEY (produto_id) REFERENCES produtos(id) ON DELETE SET NULL,

  CONSTRAINT fk_venda_funcionario 
    FOREIGN KEY (funcionario_venda_id) REFERENCES funcionarios(id) ON DELETE SET NULL
);

-- COMPRAS
CREATE TABLE compra (
  id INT AUTO_INCREMENT PRIMARY KEY,
  fornecedor_id INT,
  produto_id    INT NOT NULL,
  funcionario_compra_id INT,
  data_compra   DATE NOT NULL,
  quantidade    INT NOT NULL,
  preco_unit    DECIMAL(10,2) NOT NULL,
  valor_total   DECIMAL(10,2),

  CONSTRAINT fk_compra_fornecedor 
    FOREIGN KEY (fornecedor_id) REFERENCES fornecedor(id) ON DELETE SET NULL,

  CONSTRAINT fk_compra_produto 
    FOREIGN KEY (produto_id) REFERENCES produtos(id) ON DELETE CASCADE,

  CONSTRAINT fk_compra_funcionario 
    FOREIGN KEY (funcionario_compra_id) REFERENCES funcionarios(id) ON DELETE SET NULL
);
